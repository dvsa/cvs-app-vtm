<ng-template [ngTemplateOutlet]="isEditing ? editDefect : viewDefect" [ngTemplateOutletContext]="{ data: form }"></ng-template>

<ng-template #viewDefect let-data="data">
  <dl *ngIf="data.getCleanValue(data) as defect" class="govuk-summary-list">
    <ng-template
      [ngTemplateOutlet]="viewDefectRow"
      [ngTemplateOutletContext]="{
        label: 'Defect label',
        data: combined(defect.deficiencyRef, defect.deficiencyCategory)
      }"
    ></ng-template>

    <ng-template
      [ngTemplateOutlet]="viewDefectRow"
      [ngTemplateOutletContext]="{ label: 'Category', data: combined(defect.imNumber, defect.imDescription) }"
    ></ng-template>

    <ng-template
      [ngTemplateOutlet]="viewDefectRow"
      [ngTemplateOutletContext]="{ label: 'Item', data: combined(defect.itemNumber, defect.itemDescription) }"
    ></ng-template>

    <ng-template
      [ngTemplateOutlet]="viewDefectRow"
      [ngTemplateOutletContext]="{
        label: 'Description',
        data: combined(defect.deficiencyId, defect.deficiencySubId, defect.deficiencyText)
      }"
    ></ng-template>

    <ng-template
      [ngTemplateOutlet]="viewDefectRow"
      [ngTemplateOutletContext]="{ label: 'Location', data: combined(mapLocationText(defect.additionalInformation?.location)) }"
    ></ng-template>

    <ng-template
      [ngTemplateOutlet]="viewDefectRow"
      [ngTemplateOutletContext]="{ label: 'Repaired during test', data: combined(defect.prs) }"
    ></ng-template>

    <ng-template
      [ngTemplateOutlet]="viewDefectRow"
      [ngTemplateOutletContext]="{ label: 'Prohibition issued', data: combined(defect.prohibitionIssued) }"
    ></ng-template>

    <ng-template
      [ngTemplateOutlet]="viewDefectRow"
      [ngTemplateOutletContext]="{ label: 'Additional defect details', data: combined(defect.additionalInformation?.notes) }"
    ></ng-template>
  </dl>
</ng-template>

<ng-template #viewDefectRow let-label="label" let-data="data">
  <div class="govuk-summary-list__row">
    <dt class="govuk-summary-list__key">{{ label }}</dt>
    <dd class="govuk-summary-list__value">{{ data }}</dd>
  </div>
</ng-template>

<ng-template #editDefect>
  <app-button type="underline" (click)="removeDefect.emit(index)">Remove</app-button>
  <ng-container [formGroup]="form">
    <app-text-input formControlName="deficiencyRef" label="Deficiency ref"></app-text-input>
    <app-text-input formControlName="deficiencyCategory" label="Deficiency category"></app-text-input>
    <app-text-input formControlName="imNumber" label="IM number"></app-text-input>
    <app-text-input formControlName="imDescription" label="IM description"></app-text-input>
    <app-text-input formControlName="itemNumber" label="Item No."></app-text-input>
    <app-text-input formControlName="itemDescription" label="Item description"></app-text-input>
    <app-text-input formControlName="deficiencyId" label="Deficiency ID"></app-text-input>
    <app-text-input formControlName="deficiencySubId" label="Deficiency sub ID"></app-text-input>
    <app-text-input formControlName="deficiencyText" label="Deficiency text"></app-text-input>

    <ng-container formGroupName="additionalInformation">
      <ng-container formGroupName="location">
        <app-text-input formControlName="vertical" label="Vertical"></app-text-input>
        <app-text-input formControlName="horizontal" label="Horizontal"></app-text-input>
        <app-text-input formControlName="lateral" label="Lateral"></app-text-input>
        <app-text-input formControlName="longitudinal" label="Longitudinal"></app-text-input>
        <app-text-input formControlName="rowNumber" label="Row number"></app-text-input>
        <app-text-input formControlName="seatNumber" label="Seat number"></app-text-input>
        <app-text-input formControlName="axleNumber" label="Axle number"></app-text-input>
      </ng-container>
      <app-text-input formControlName="notes" label="Notes"></app-text-input>
    </ng-container>

    <app-radio-group
      name="prs"
      formControlName="prs"
      label="PRS"
      [options]="[
        { value: true, label: 'Yes' },
        { value: false, label: 'No' }
      ]"
    ></app-radio-group>
    <app-radio-group
      name="prohibitionIssued"
      formControlName="prohibitionIssued"
      label="Prohibition issued"
      [options]="[
        { value: true, label: 'Yes' },
        { value: false, label: 'No' }
      ]"
    ></app-radio-group>
  </ng-container>
</ng-template>
