<!-- Initiate the recursive template rendering. -->
<!-- <ng-template [ngTemplateOutlet]="nodeTemplateRef" [ngTemplateOutletContext]="{ node: data }"> </ng-template> -->

<!-- Define the recursive template. -->
<!-- <ng-template #nodeTemplateRef let-node="node">
  <ng-container [ngSwitch]="node.type">
    <ng-container *ngSwitchCase="'control'">
      <ng-template [ngTemplateOutlet]="control" [ngTemplateOutletContext]="{ $implicit: node }"></ng-template>
    </ng-container>

    <ng-container *ngSwitchCase="'group'">
      <h2>{{ node.name }}</h2>
      <ng-template [ngTemplateOutlet]="childNode" [ngTemplateOutletContext]="{ $implicit: node }"></ng-template>
    </ng-container>
  </ng-container>
</ng-template>

<ng-template #control let-control>
  <app-text-input [label]="control.label" [name]="control.name" [formControlName]="control.name"></app-text-input>
</ng-template>

<ng-template #childNode let-childNode>
  <ng-template ngFor let-child [ngForOf]="childNode.children">
    <div class="node">
      <div class="node__children">
        <ng-template [ngTemplateOutlet]="nodeTemplateRef" [ngTemplateOutletContext]="{ node: child }"> </ng-template>
      </div>
    </div>
  </ng-template>
</ng-template>

<pre>{{ form.value | json }}</pre> -->

<ng-template [ngTemplateOutlet]="nodeTemplateRef" [ngTemplateOutletContext]="{ form: myForm }"> </ng-template>

<ng-template #nodeTemplateRef let-form="form">
  <ng-container *ngFor="let control of entriesOf(form.controls); let i = index; trackBy: trackByFn">
    <ng-container *ngIf="!control.value.controls">
      <ng-template [ngTemplateOutlet]="controlTemplate" [ngTemplateOutletContext]="{ control: control, formGroup: form }"></ng-template>
    </ng-container>
    <ng-container *ngIf="control.value.controls">
      <ng-template [ngTemplateOutlet]="nodeTemplateRef" [ngTemplateOutletContext]="{ form: form.controls[control.key] }"></ng-template>
    </ng-container>
  </ng-container>
</ng-template>

<ng-template #controlTemplate let-control="control" let-formGroup="formGroup">
  <ng-container [formGroup]="formGroup">
    <app-text-input [label]="control.key" [name]="control.key" [formControlName]="control.key"></app-text-input>
  </ng-container>
</ng-template>

<ng-template #childNode let-form>
  <div class="node">
    <div class="node__children">
      <ng-template [ngTemplateOutlet]="nodeTemplateRef" [ngTemplateOutletContext]="{ form: form }"> </ng-template>
    </div>
  </div>
</ng-template>

<pre>{{ myForm.value | json }}</pre>
