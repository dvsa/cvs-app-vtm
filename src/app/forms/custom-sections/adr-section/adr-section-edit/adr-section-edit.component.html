<div [formGroup]="form">
  <div class="govuk-form-group">
    <h1 class="govuk-label-wrapper">
      <label class="govuk-label govuk-label--m" for="techRecord_adrDetails_dangerousGoods"> Able to carry dangerous goods </label>
    </h1>
    <div class="govuk-radios" data-module="govuk-radios">
      <div class="govuk-radios__item" *ngFor="let option of dangerousGoodsOptions">
        <input
          type="radio"
          id="techRecord_adrDetails_dangerousGoods-{{ option.value }}-radio"
          formControlName="techRecord_adrDetails_dangerousGoods"
          class="govuk-radios__input"
          [value]="option.value"
        />
        <label class="govuk-label govuk-radios__label" for="techRecord_adrDetails_dangerousGoods-{{ option.value }}-radio'">
          {{ option.label }}
        </label>
      </div>
    </div>
  </div>

  <!-- When dangerous goods is true -->
  <ng-container *ngIf="adrService.canDisplayDangerousGoodsSection($any(form.getRawValue()))">
    <!-- Applicant Details -->
    <ng-container>
      <span class="govuk-label govuk-label--m">Applicant Details</span>

      <!-- Applicant Details Name -->
      <div class="govuk-form-group">
        <h1 class="govuk-label-wrapper">
          <label class="govuk-label govuk-label--m" for="techRecord_adrDetails_applicantDetails_name"> Name </label>
        </h1>
        <app-control-errors for="techRecord_adrDetails_applicantDetails_name" />
        <input govukInput formControlName="techRecord_adrDetails_applicantDetails_name" />
      </div>

      <!-- Applicant Details Street -->
      <div class="govuk-form-group">
        <h1 class="govuk-label-wrapper">
          <label class="govuk-label govuk-label--m" for="techRecord_adrDetails_applicantDetails_street"> Street </label>
        </h1>
        <app-control-errors for="techRecord_adrDetails_applicantDetails_street" />
        <input govukInput formControlName="techRecord_adrDetails_applicantDetails_street" />
      </div>

      <!-- Applicant Details Town -->
      <div class="govuk-form-group">
        <h1 class="govuk-label-wrapper">
          <label class="govuk-label govuk-label--m" for="techRecord_adrDetails_applicantDetails_town"> Town </label>
        </h1>
        <app-control-errors for="techRecord_adrDetails_applicantDetails_town" />
        <input govukInput formControlName="techRecord_adrDetails_applicantDetails_town" />
      </div>

      <!-- Applicant Details City -->
      <div class="govuk-form-group">
        <h1 class="govuk-label-wrapper">
          <label class="govuk-label govuk-label--m" for="techRecord_adrDetails_applicantDetails_city"> City </label>
        </h1>
        <app-control-errors for="techRecord_adrDetails_applicantDetails_city" />
        <input govukInput formControlName="techRecord_adrDetails_applicantDetails_city" />
      </div>

      <!-- Applicant Details Postcode -->
      <div class="govuk-form-group">
        <h1 class="govuk-label-wrapper">
          <label class="govuk-label govuk-label--m" for="techRecord_adrDetails_applicantDetails_postcode"> Postcode </label>
        </h1>
        <app-control-errors for="techRecord_adrDetails_applicantDetails_postcode" />
        <input govukInput formControlName="techRecord_adrDetails_applicantDetails_postcode" />
      </div>
    </ng-container>

    <!-- ADR Details -->
    <ng-container>
      <span class="govuk-label govuk-label--m">ADR Details</span>

      <!-- ADR Body Type -->
      <div class="govuk-form-group">
        <h1 class="govuk-label-wrapper">
          <label class="govuk-label govuk-label--m" for="techRecord_adrDetails_vehicleDetails_type"> ADR body type </label>
        </h1>
        <app-control-errors for="techRecord_adrDetails_vehicleDetails_type" />
        <select govukSelect formControlName="techRecord_adrDetails_vehicleDetails_type">
          <option [value]="option.value" *ngFor="let option of adrBodyTypesOptions">{{ option.label }}</option>
        </select>
      </div>

      <!-- Used on international journeys -->
      <div class="govuk-form-group">
        <h1 class="govuk-label-wrapper">
          <label class="govuk-label govuk-label--m" for="techRecord_adrDetails_vehicleDetails_usedOnInternationalJourneys">
            Vehicle used on international journeys
          </label>
        </h1>
        <div class="govuk-radios" data-module="govuk-radios">
          <div class="govuk-radios__item" *ngFor="let option of usedOnInternationJourneysOptions">
            <input
              type="radio"
              id="techRecord_adrDetails_vehicleDetails_usedOnInternationalJourneys-{{ option.value }}-radio"
              formControlName="techRecord_adrDetails_vehicleDetails_usedOnInternationalJourneys"
              class="govuk-radios__input"
              [value]="option.value"
            />
            <label
              class="govuk-label govuk-radios__label"
              for="techRecord_adrDetails_vehicleDetails_usedOnInternationalJourneys-{{ option.value }}-radio'"
            >
              {{ option.label }}
            </label>
          </div>
        </div>
      </div>

      <!-- Approval date -->
      <app-date-controls formControlName="techRecord_adrDetails_vehicleDetails_approvalDate" #approvalDate>
        <div class="govuk-form-group" [formGroup]="approvalDate.form">
          <h1 class="govuk-label-wrapper">
            <label class="govuk-label govuk-label--m" for="techRecord_adrDetails_vehicleDetails_approvalDate"> Date processed </label>
          </h1>
          <p
            id="techRecord_adrDetails_vehicleDetails_approvalDate-error"
            class="govuk-error-message"
            *ngIf="isInvalid('techRecord_adrDetails_vehicleDetails_approvalDate') || approvalDate.form.invalid"
          >
            <span class="govuk-visually-hidden">Error:</span>
            <span *ngIf="form.get('techRecord_adrDetails_vehicleDetails_approvalDate')?.getError('required') as error">{{ error }}</span>
            <span *ngIf="form.get('techRecord_adrDetails_vehicleDetails_approvalDate')?.getError('invalidDate') as error">{{ error }}</span>
            <span *ngIf="form.get('techRecord_adrDetails_vehicleDetails_approvalDate')?.getError('pastDate') as error">{{ error }}</span>
            <span *ngIf="approvalDate.form.get('day')?.getError('min') || approvalDate.form.get('day')?.getError('max')">
              Day must between 1 and 31
            </span>
            <span *ngIf="approvalDate.form.get('month')?.getError('min') || approvalDate.form.get('month')?.getError('max')">
              Month must between 1 and 12
            </span>
            <span *ngIf="approvalDate.form.get('year')?.getError('min') || approvalDate.form.get('year')?.getError('max')">
              Year must between 1000 and 9999
            </span>
          </p>
          <div class="govuk-date-input" id="techRecord_adrDetails_vehicleDetails_approvalDate">
            <div class="govuk-date-input__item">
              <div class="govuk-form-group">
                <label class="govuk-label govuk-date-input__label" for="techRecord_adrDetails_vehicleDetails_approvalDate-day"> Day </label>
                <input
                  appFocusNext
                  appNumberOnly
                  formControlName="day"
                  class="govuk-input govuk-date-input__input govuk-input--width-2"
                  id="techRecord_adrDetails_vehicleDetails_approvalDate-day"
                  name="techRecord_adrDetails_vehicleDetails_approvalDate-day"
                  type="number"
                  inputmode="numeric"
                  [class.govuk-input--error]="approvalDate.form.get('day')?.invalid && approvalDate.form.get('day')?.touched"
                />
              </div>
            </div>
            <div class="govuk-date-input__item">
              <div class="govuk-form-group">
                <label class="govuk-label govuk-date-input__label" for="techRecord_adrDetails_vehicleDetails_approvalDate-month"> Month </label>
                <input
                  appFocusNext
                  appNumberOnly
                  formControlName="month"
                  class="govuk-input govuk-date-input__input govuk-input--width-2"
                  id="techRecord_adrDetails_vehicleDetails_approvalDate-month"
                  name="techRecord_adrDetails_vehicleDetails_approvalDate-month"
                  type="number"
                  inputmode="numeric"
                  [class.govuk-input--error]="approvalDate.form.get('month')?.invalid && approvalDate.form.get('month')?.touched"
                />
              </div>
            </div>
            <div class="govuk-date-input__item">
              <div class="govuk-form-group">
                <label class="govuk-label govuk-date-input__label" for="techRecord_adrDetails_vehicleDetails_approvalDate-year"> Year </label>
                <input
                  appFocusNext
                  appNumberOnly
                  formControlName="year"
                  class="govuk-input govuk-date-input__input govuk-input--width-4"
                  id="techRecord_adrDetails_vehicleDetails_approvalDate-year"
                  name="techRecord_adrDetails_vehicleDetails_approvalDate-year"
                  type="number"
                  inputmode="numeric"
                  [class.govuk-input--error]="approvalDate.form.get('year')?.invalid && approvalDate.form.get('year')?.touched"
                />
              </div>
            </div>
          </div>
        </div>
      </app-date-controls>

      <!-- Permitted dangerous goods -->
      <div class="govuk-form-group" id="techRecord_adrDetails_permittedDangerousGoods">
        <fieldset class="govuk-fieldset" aria-describedby="techRecord_adrDetails_permittedDangerousGoods-error">
          <h1 class="govuk-label-wrapper">
            <label class="govuk-label govuk-label--m" for="techRecord_adrDetails_permittedDangerousGoods"> Permitted dangerous goods </label>
          </h1>
          <app-control-errors for="techRecord_adrDetails_permittedDangerousGoods" />
          <div class="govuk-checkboxes" data-module="govuk-checkboxes">
            <div class="govuk-checkboxes__item" *ngFor="let option of permittedDangerousGoodsOptions; let i = index">
              <input
                class="govuk-checkboxes__input"
                id="techRecord_adrDetails_permittedDangerousGoods-{{ option.value }}"
                type="checkbox"
                [checked]="form.get('techRecord_adrDetails_permittedDangerousGoods')?.value?.includes(option.value.toString())"
                [attr.aria-describedby]="
                  isInvalid('techRecord_adrDetails_permittedDangerousGoods') ? 'techRecord_adrDetails_permittedDangerousGoods-error' : null
                "
                (input)="toggle('techRecord_adrDetails_permittedDangerousGoods', option.value.toString())"
              />
              <label class="govuk-label govuk-checkboxes__label" for="techRecord_adrDetails_permittedDangerousGoods-{{ option.value }}">
                {{ option.label }}
              </label>
            </div>
          </div>
        </fieldset>
      </div>

      <!-- Compatibility group J -->
      <div class="govuk-form-group" *ngIf="adrService.canDisplayCompatibilityGroupJSection($any(form.getRawValue()))">
        <h1 class="govuk-label-wrapper">
          <label class="govuk-label govuk-label--m" for="techRecord_adrDetails_compatibilityGroupJ"> Compatibility group J </label>
        </h1>
        <app-control-errors for="techRecord_adrDetails_compatibilityGroupJ" />
        <div class="govuk-radios" data-module="govuk-radios">
          <div class="govuk-radios__item" *ngFor="let option of compatibilityGroupJOptions; let i = index">
            <input
              type="radio"
              id="techRecord_adrDetails_compatibilityGroupJ-{{ option.value }}-radio"
              formControlName="techRecord_adrDetails_compatibilityGroupJ"
              class="govuk-radios__input"
              [value]="option.value"
            />
            <label class="govuk-label govuk-radios__label" for="techRecord_adrDetails_compatibilityGroupJ-{{ option.value }}-radio'">
              {{ option.label }}
            </label>
          </div>
        </div>
      </div>

      <!-- Guidance notes -->
      <div class="govuk-form-group" id="techRecord_adrDetails_additionalNotes_number">
        <fieldset class="govuk-fieldset" aria-describedby="techRecord_adrDetails_additionalNotes_number-error">
          <h1 class="govuk-label-wrapper">
            <label class="govuk-label govuk-label--m" for="techRecord_adrDetails_additionalNotes_number"> Guidance notes </label>
          </h1>
          <app-control-errors for="techRecord_adrDetails_additionalNotes_number" />
          <div class="govuk-checkboxes" data-module="govuk-checkboxes">
            <div class="govuk-checkboxes__item" *ngFor="let option of guidanceNotesOptions">
              <input
                class="govuk-checkboxes__input"
                id="techRecord_adrDetails_additionalNotes_number-{{ option.value }}"
                type="checkbox"
                [checked]="form.get('techRecord_adrDetails_additionalNotes_number')?.value?.includes(option.value.toString())"
                [attr.aria-describedby]="
                  isInvalid('techRecord_adrDetails_additionalNotes_number') ? 'techRecord_adrDetails_additionalNotes_number-error' : null
                "
                (input)="toggle('techRecord_adrDetails_additionalNotes_number', option.value.toString())"
              />
              <label class="govuk-label govuk-checkboxes__label" for="techRecord_adrDetails_additionalNotes_number-{{ option.value }}">
                {{ option.label }}
              </label>
            </div>
          </div>
        </fieldset>
      </div>

      <!-- ADR type approval number -->
      <div class="govuk-form-group">
        <h1 class="govuk-label-wrapper">
          <label class="govuk-label govuk-label--m" for="techRecord_adrDetails_adrTypeApprovalNo"> ADR type approval number </label>
        </h1>
        <app-control-errors for="techRecord_adrDetails_adrTypeApprovalNo" />
        <input govukInput formControlName="techRecord_adrDetails_adrTypeApprovalNo" />
      </div>
    </ng-container>

    <!-- When ADR body type contains the words 'tank' or 'battery' -->
    <ng-container *ngIf="adrService.canDisplayTankOrBatterySection($any(form.getRawValue()))">
      <!-- Tank details section -->
      <ng-container>
        <!-- Tank Make -->
        <div class="govuk-form-group">
          <h1 class="govuk-label-wrapper">
            <label class="govuk-label govuk-label--m" for="techRecord_adrDetails_tank_tankDetails_tankManufacturer"> Tank Make </label>
          </h1>
          <app-control-errors for="techRecord_adrDetails_tank_tankDetails_tankManufacturer" />
          <input govukInput formControlName="techRecord_adrDetails_tank_tankDetails_tankManufacturer" />
        </div>

        <!-- Tank Year of manufacture -->
        <div class="govuk-form-group">
          <h1 class="govuk-label-wrapper">
            <label class="govuk-label govuk-label--m" for="techRecord_adrDetails_tank_tankDetails_yearOfManufacture">
              Tank year of manufacture
            </label>
          </h1>
          <app-control-errors for="techRecord_adrDetails_tank_tankDetails_yearOfManufacture" />
          <input govukInput formControlName="techRecord_adrDetails_tank_tankDetails_yearOfManufacture" />
        </div>

        <!-- Tank manufacturer serial number -->
        <div class="govuk-form-group">
          <h1 class="govuk-label-wrapper">
            <label class="govuk-label govuk-label--m" for="techRecord_adrDetails_tank_tankDetails_tankManufacturerSerialNo">
              Manufacturer serial number
            </label>
          </h1>
          <app-control-errors for="techRecord_adrDetails_tank_tankDetails_tankManufacturerSerialNo" />
          <input govukInput formControlName="techRecord_adrDetails_tank_tankDetails_tankManufacturerSerialNo" />
        </div>

        <!-- Tank type approval number -->
        <div class="govuk-form-group">
          <h1 class="govuk-label-wrapper">
            <label class="govuk-label govuk-label--m" for="techRecord_adrDetails_tank_tankDetails_tankTypeAppNo"> Tank type approval number </label>
          </h1>
          <app-control-errors for="techRecord_adrDetails_tank_tankDetails_tankTypeAppNo" />
          <input govukInput formControlName="techRecord_adrDetails_tank_tankDetails_tankTypeAppNo" />
        </div>

        <!-- Tank code -->
        <div class="govuk-form-group">
          <h1 class="govuk-label-wrapper">
            <label class="govuk-label govuk-label--m" for="techRecord_adrDetails_tank_tankDetails_tankCode"> Code </label>
          </h1>
          <app-control-errors for="techRecord_adrDetails_tank_tankDetails_tankCode" />
          <input govukInput formControlName="techRecord_adrDetails_tank_tankDetails_tankCode" />
        </div>

        <!-- Substances permitted -->
        <div class="govuk-form-group">
          <h1 class="govuk-label-wrapper">
            <label class="govuk-label govuk-label--m" for="techRecord_adrDetails_tank_tankDetails_tankStatement_substancesPermitted">
              Substances permitted
            </label>
          </h1>
          <app-control-errors for="techRecord_adrDetails_tank_tankDetails_tankStatement_substancesPermitted" />
          <div class="govuk-radios" data-module="govuk-radios">
            <div class="govuk-radios__item" *ngFor="let option of tankStatementSubstancePermittedOptions">
              <input
                type="radio"
                id="techRecord_adrDetails_tank_tankDetails_tankStatement_substancesPermitted-{{ option.value }}-radio"
                formControlName="techRecord_adrDetails_tank_tankDetails_tankStatement_substancesPermitted"
                class="govuk-radios__input"
                [value]="option.value"
              />
              <label
                class="govuk-label govuk-radios__label"
                for="techRecord_adrDetails_tank_tankDetails_tankStatement_substancesPermitted-{{ option.value }}-radio'"
              >
                {{ option.label }}
              </label>
            </div>
          </div>
        </div>

        <!-- When tank statement (substances permitted) is 'Under UN Number' -->
        <ng-container *ngIf="adrService.canDisplayTankStatementSelectSection($any(form.getRawValue()))">
          <!-- Tank statement select -->
          <div class="govuk-form-group">
            <h1 class="govuk-label-wrapper">
              <label class="govuk-label govuk-label--m" for="techRecord_adrDetails_tank_tankDetails_tankStatement_select"> Select </label>
            </h1>
            <app-control-errors for="techRecord_adrDetails_tank_tankDetails_tankStatement_select" />
            <div class="govuk-radios" data-module="govuk-radios">
              <div class="govuk-radios__item" *ngFor="let option of tankStatementSelectOptions">
                <input
                  type="radio"
                  id="techRecord_adrDetails_tank_tankDetails_tankStatement_select-{{ option.value }}-radio"
                  formControlName="techRecord_adrDetails_tank_tankDetails_tankStatement_select"
                  class="govuk-radios__input"
                  [value]="option.value"
                />
                <label
                  class="govuk-label govuk-radios__label"
                  for="techRecord_adrDetails_tank_tankDetails_tankStatement_select-{{ option.value }}-radio'"
                >
                  {{ option.label }}
                </label>
              </div>
            </div>
          </div>

          <!-- When select is 'statement' -->
          <ng-container *ngIf="adrService.canDisplayTankStatementStatementSection($any(form.getRawValue()))">
            <!-- Reference number -->
            <div class="govuk-form-group">
              <h1 class="govuk-label-wrapper">
                <label class="govuk-label govuk-label--m" for="techRecord_adrDetails_tank_tankDetails_tankStatement_statement">
                  Reference Number
                </label>
              </h1>
              <app-control-errors for="techRecord_adrDetails_tank_tankDetails_tankStatement_statement" />
              <input govukInput formControlName="techRecord_adrDetails_tank_tankDetails_tankStatement_statement" />
            </div>
          </ng-container>

          <!-- When select is 'product '-->
          <ng-container *ngIf="adrService.canDisplayTankStatementProductListSection($any(form.getRawValue()))">
            <!-- Reference number -->
            <div class="govuk-form-group">
              <h1 class="govuk-label-wrapper">
                <label class="govuk-label govuk-label--m" for="techRecord_adrDetails_tank_tankDetails_tankStatement_productListRefNo">
                  Reference number
                </label>
              </h1>
              <app-control-errors for="techRecord_adrDetails_tank_tankDetails_tankStatement_productListRefNo" />
              <input govukInput formControlName="techRecord_adrDetails_tank_tankDetails_tankStatement_productListRefNo" />
            </div>

            <!-- UN numbers -->
            <app-control-errors for="techRecord_adrDetails_tank_tankDetails_tankStatement_productListUnNo" />
            
            <div class="govuk-form-group" formArrayName="techRecord_adrDetails_tank_tankDetails_tankStatement_productListUnNo">
              <fieldset
                class="govuk-fieldset"
                *ngFor="let inspection of form.controls.techRecord_adrDetails_tank_tankDetails_tankStatement_productListUnNo.controls; let i = index"
              >
                <div class="govuk-form-group">
                  <h1 class="govuk-label-wrapper">
                    <label class="govuk-label govuk-label--m" for="techRecord_adrDetails_tank_tankDetails_tankStatement_productListUnNo-{{ i + 1 }}">
                      UN Number {{ i + 1 }}
                    </label>
                  </h1>
                 <ng-container *ngIf="form.controls.techRecord_adrDetails_tank_tankDetails_tankStatement_productListUnNo.controls.length > 1; else singleUnNumber">
                  <table class="govuk-table">
                    <tbody class="govuk-table__body">
                      <tr class="govuk-table__row">
                        <td class="govuk-table__cell">
                          <input
                            id="techRecord_adrDetails_tank_tankDetails_tankStatement_productListUnNo-{{ i + 1 }}"
                            type="text"
                            name="techRecord_adrDetails_tank_tankDetails_tankStatement_productListUnNo-{{ i + 1 }}"
                            formControlName="{{ i }}"
                            class="govuk-input"
                          />
                        </td>
                        <td class="govuk-table__cell">
                          <p class="govuk-body">
                            <a class="govuk-link" href="javascript:void(0)" (click)="removeUNNumber(i)">Remove</a>
                         </p>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                 </ng-container>
                 <ng-template #singleUnNumber>
                    <input
                      id="techRecord_adrDetails_tank_tankDetails_tankStatement_productListUnNo-{{ i + 1 }}"
                      type="text"
                      name="techRecord_adrDetails_tank_tankDetails_tankStatement_productListUnNo-{{ i + 1 }}"
                      formControlName="{{ i }}"
                      class="govuk-input"
                    />
                 </ng-template>
                </div>
              </fieldset>
              <p class="govuk-body">
                <a class="govuk-link" href="javascript:void(0)" (click)="addUNNumber()">Add UN Number</a>
              </p>
            </div>
          </ng-container>
        </ng-container>
      </ng-container>

      <!-- Special provisions -->
      <div class="govuk-form-group govuk-character-count">
        <h1 class="govuk-label-wrapper">
          <label class="govuk-label govuk-label--m" for="techRecord_adrDetails_tank_tankDetails_specialProvisions"> Special Provisions </label>
        </h1>
        <app-control-errors for="techRecord_adrDetails_tank_tankDetails_specialProvisions" />
        <textarea govukTextarea formControlName="techRecord_adrDetails_tank_tankDetails_specialProvisions"></textarea>
        <app-character-count for="techRecord_adrDetails_tank_tankDetails_specialProvisions" [limit]="500" />
      </div>

      <!-- Tank Inspections section -->
      <ng-container>
        <span class="govuk-label govuk-label--m">Tank Inspections</span>

        <!-- TC2: Certificate Number -->
        <div class="govuk-form-group">
          <h1 class="govuk-label-wrapper">
            <label class="govuk-label govuk-label--m" for="techRecord_adrDetails_tank_tankDetails_tc2Details_tc2IntermediateApprovalNo">
              TC2: Certificate Number
            </label>
          </h1>
          <app-control-errors for="techRecord_adrDetails_tank_tankDetails_tc2Details_tc2IntermediateApprovalNo" />
          <input govukInput formControlName="techRecord_adrDetails_tank_tankDetails_tc2Details_tc2IntermediateApprovalNo" />
        </div>

        <div class="govuk-section-break--visible govuk-!-margin-top-4 govuk-!-margin-bottom-6"></div>

        <!-- TC2: Expiry Date -->
        <app-date-controls formControlName="techRecord_adrDetails_tank_tankDetails_tc2Details_tc2IntermediateExpiryDate" #tc2ExpiryDate>
          <div class="govuk-form-group">
            <h1 class="govuk-label-wrapper">
              <label class="govuk-label govuk-label--m" for="techRecord_adrDetails_tank_tankDetails_tc2Details_tc2IntermediateExpiryDate">
                TC2: Expiry Date
              </label>
            </h1>
            <app-control-errors for="techRecord_adrDetails_tank_tankDetails_tc2Details_tc2IntermediateExpiryDate" />
            <div [formGroup]="tc2ExpiryDate.form">
              <p
              id="techRecord_adrDetails_tank_tankDetails_tc2Details_tc2IntermediateExpiryDate-error"
              class="govuk-error-message"
              *ngIf="tc2ExpiryDate.form.invalid"
            >
              <span class="govuk-visually-hidden">Error:</span>
              <span *ngIf="form.get('techRecord_adrDetails_tank_tankDetails_tc2Details_tc2IntermediateExpiryDate')?.getError('required') as error">
                {{ error }}
              </span>
              <span *ngIf="form.get('techRecord_adrDetails_tank_tankDetails_tc2Details_tc2IntermediateExpiryDate')?.getError('invalidDate') as error">
                {{ error }}
              </span>
              <span *ngIf="tc2ExpiryDate.form.get('day')?.getError('min') || tc2ExpiryDate.form.get('day')?.getError('max')">
                Day must between 1 and 31
              </span>
              <span *ngIf="tc2ExpiryDate.form.get('month')?.getError('min') || tc2ExpiryDate.form.get('month')?.getError('max')">
                Month must between 1 and 12
              </span>
              <span *ngIf="tc2ExpiryDate.form.get('year')?.getError('min') || tc2ExpiryDate.form.get('year')?.getError('max')">
                Year must between 1000 and 9999
              </span>
            </p>
            <div class="govuk-date-input" id="techRecord_adrDetails_tank_tankDetails_tc2Details_tc2IntermediateExpiryDate">
              <div class="govuk-date-input__item">
                <div class="govuk-form-group">
                  <label
                    class="govuk-label govuk-date-input__label"
                    for="techRecord_adrDetails_tank_tankDetails_tc2Details_tc2IntermediateExpiryDate-day"
                  >
                    Day
                  </label>
                  <input
                    appFocusNext
                    appNumberOnly
                    formControlName="day"
                    class="govuk-input govuk-date-input__input govuk-input--width-2"
                    id="techRecord_adrDetails_tank_tankDetails_tc2Details_tc2IntermediateExpiryDate-day"
                    name="techRecord_adrDetails_tank_tankDetails_tc2Details_tc2IntermediateExpiryDate-day"
                    type="number"
                    inputmode="numeric"
                    [class.govuk-input--error]="tc2ExpiryDate.form.get('day')?.invalid && tc2ExpiryDate.form.get('day')?.touched"
                  />
                </div>
              </div>
              <div class="govuk-date-input__item">
                <div class="govuk-form-group">
                  <label
                    class="govuk-label govuk-date-input__label"
                    for="techRecord_adrDetails_tank_tankDetails_tc2Details_tc2IntermediateExpiryDate-month"
                  >
                    Month
                  </label>
                  <input
                    appFocusNext
                    appNumberOnly
                    formControlName="month"
                    class="govuk-input govuk-date-input__input govuk-input--width-2"
                    id="techRecord_adrDetails_tank_tankDetails_tc2Details_tc2IntermediateExpiryDate-month"
                    name="techRecord_adrDetails_tank_tankDetails_tc2Details_tc2IntermediateExpiryDate-month"
                    type="number"
                    inputmode="numeric"
                    [class.govuk-input--error]="tc2ExpiryDate.form.get('month')?.invalid && tc2ExpiryDate.form.get('month')?.touched"
                  />
                </div>
              </div>
              <div class="govuk-date-input__item">
                <div class="govuk-form-group">
                  <label
                    class="govuk-label govuk-date-input__label"
                    for="techRecord_adrDetails_tank_tankDetails_tc2Details_tc2IntermediateExpiryDate-year"
                  >
                    Year
                  </label>
                  <input
                    appFocusNext
                    appNumberOnly
                    formControlName="year"
                    class="govuk-input govuk-date-input__input govuk-input--width-4"
                    id="techRecord_adrDetails_tank_tankDetails_tc2Details_tc2IntermediateExpiryDate-year"
                    name="techRecord_adrDetails_tank_tankDetails_tc2Details_tc2IntermediateExpiryDate-year"
                    type="number"
                    inputmode="numeric"
                    [class.govuk-input--error]="tc2ExpiryDate.form.get('year')?.invalid && tc2ExpiryDate.form.get('year')?.touched"
                  />
                </div>
              </div>
            </div>
            </div>
          </div>
        </app-date-controls>

        <!-- TC3: Inspections -->
        <div class="govuk-form-group" formArrayName="techRecord_adrDetails_tank_tankDetails_tc3Details">
          <fieldset
            class="govuk-fieldset"
            formGroupName="{{ i }}"
            *ngFor="let inspection of form.controls.techRecord_adrDetails_tank_tankDetails_tc3Details.controls; let i = index"
          >
            <!-- TC3 Inspection Type -->
            <div class="govuk-form-group">
              <h1 class="govuk-label-wrapper">
                <label class="govuk-label govuk-label--m" for="tc3Type"> TC3: Inspection Type </label>
              </h1>
              <app-control-errors for="tc3Type" />
              <select govukSelect formControlName="tc3Type">
                <option [value]="option.value" *ngFor="let option of tc3InspectionOptions">{{ option.label }}</option>
              </select>
            </div>

            <!-- TC3 Certificate Number -->
            <div class="govuk-form-group">
              <h1 class="govuk-label-wrapper">
                <label class="govuk-label govuk-label--m" for="tc3PeriodicNumber"> TC3: Certificate Number </label>
              </h1>
              <app-control-errors for="tc3PeriodicNumber" />
              <input
                id="tc3PeriodicNumber"
                type="text"
                name="tc3PeriodicNumber"
                formControlName="tc3PeriodicNumber"
                class="govuk-input govuk-!-width-one-third"
              />
            </div>

            <!-- TC3 Expiry Date -->
            <app-date-controls formControlName="tc3PeriodicExpiryDate" #tc3ApprovalDate>
              <div class="govuk-form-group">
                <h1 class="govuk-label-wrapper">
                  <label class="govuk-label govuk-label--m" for="tc3PeriodicExpiryDate-{{ i + 1 }}"> TC3: Expiry Date </label>
                </h1>
                <app-control-errors for="tc3PeriodicExpiryDate" />
                <div [formGroup]="tc3ApprovalDate.form">
                  <p id="tc3PeriodicExpiryDate-{{ i + 1 }}-error" class="govuk-error-message" *ngIf="tc3ApprovalDate.form.invalid">
                    <span class="govuk-visually-hidden">Error:</span>
                    <span *ngIf="form.get('tc3PeriodicExpiryDate')?.getError('required') as error">
                      {{ error }}
                    </span>
                    <span *ngIf="form.get('tc3PeriodicExpiryDate')?.getError('invalidDate') as error">
                      {{ error }}
                    </span>
                    <span *ngIf="tc3ApprovalDate.form.get('day')?.getError('min') || tc3ApprovalDate.form.get('day')?.getError('max')">
                      Day must between 1 and 31
                    </span>
                    <span *ngIf="tc3ApprovalDate.form.get('month')?.getError('min') || tc3ApprovalDate.form.get('month')?.getError('max')">
                      Month must between 1 and 12
                    </span>
                    <span *ngIf="tc3ApprovalDate.form.get('year')?.getError('min') || tc3ApprovalDate.form.get('year')?.getError('max')">
                      Year must between 1000 and 9999
                    </span>
                  </p>
                  <div class="govuk-date-input" id="tc3PeriodicExpiryDate-{{ i + 1 }}">
                    <div class="govuk-date-input__item">
                      <div class="govuk-form-group">
                        <label class="govuk-label govuk-date-input__label" for="tc3PeriodicExpiryDate-{{ i + 1 }}-day"> Day </label>
                        <input
                          appFocusNext
                          appNumberOnly
                          formControlName="day"
                          class="govuk-input govuk-date-input__input govuk-input--width-2"
                          id="tc3PeriodicExpiryDate-{{ i + 1 }}-day"
                          name="tc3PeriodicExpiryDate{{ i + 1 }}-day"
                          type="number"
                          inputmode="numeric"
                          [class.govuk-input--error]="tc3ApprovalDate.form.get('day')?.invalid && tc3ApprovalDate.form.get('day')?.touched"
                        />
                      </div>
                    </div>
                    <div class="govuk-date-input__item">
                      <div class="govuk-form-group">
                        <label class="govuk-label govuk-date-input__label" for="tc3PeriodicExpiryDate-{{ i + 1 }}-month"> Month </label>
                        <input
                          appFocusNext
                          appNumberOnly
                          formControlName="month"
                          class="govuk-input govuk-date-input__input govuk-input--width-2"
                          id="tc3PeriodicExpiryDate-{{ i + 1 }}-month"
                          name="tc3PeriodicExpiryDate-{{ i + 1 }}-month"
                          type="number"
                          inputmode="numeric"
                          [class.govuk-input--error]="tc3ApprovalDate.form.get('month')?.invalid && tc3ApprovalDate.form.get('month')?.touched"
                        />
                      </div>
                    </div>
                    <div class="govuk-date-input__item">
                      <div class="govuk-form-group">
                        <label class="govuk-label govuk-date-input__label" for="tc3PeriodicExpiryDate-{{ i + 1 }}-year"> Year </label>
                        <input
                          appFocusNext
                          appNumberOnly
                          formControlName="year"
                          class="govuk-input govuk-date-input__input govuk-input--width-4"
                          id="tc3PeriodicExpiryDate-{{ i + 1 }}-year"
                          name="tc3PeriodicExpiryDate-{{ i + 1 }}-year"
                          type="number"
                          inputmode="numeric"
                          [class.govuk-input--error]="tc3ApprovalDate.form.get('year')?.invalid && tc3ApprovalDate.form.get('year')?.touched"
                        />
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </app-date-controls>

            <!-- TC3 Footer -->
            <p class="govuk-body govuk-!-text-align-right">
              <a class="govuk-link" role="button" href="javascript:void(0)" (click)="removeTC3TankInspection(i)">Remove</a>
            </p>
            <div class="govuk-section-break--visible govuk-!-margin-top-4 govuk-!-margin-bottom-6"></div>
          </fieldset>
        </div>

        <p class="govuk-body">
          <a class="govuk-link" role="button" href="javascript:void(0)" (click)="addTC3TankInspection()">Add subsequent inspection</a>
        </p>
      </ng-container>

      <!-- Memo 07/09 (3 month extension) can be applied -->
      <div class="govuk-form-group">
        <fieldset class="govuk-fieldset" aria-describedby="techRecord_adrDetails_memosApply-error">
          <legend class="govuk-fieldset__legend govuk-fieldset__legend--m">
            <h1 class="govuk-fieldset__heading">Memo 07/09 (3 month extension) can be applied</h1>
          </legend>
          <div id="techRecord_adrDetails_memosApply-hint" class="govuk-hint">Only applicable for vehicles used on national journeys</div>
          <app-control-errors for="techRecord_adrDetails_memosApply" />
          <div class="govuk-checkboxes" data-module="govuk-checkboxes">
            <div class="govuk-checkboxes__item">
              <input
                class="govuk-checkboxes__input"
                id="techRecord_adrDetails_memosApply"
                formControlName="techRecord_adrDetails_memosApply"
                type="checkbox"
                [value]="true"
                [attr.aria-describedby]="isInvalid('techRecord_adrDetails_memosApply') ? 'techRecord_adrDetails_memosApply-error' : null"
              />
              <label class="govuk-label govuk-checkboxes__label" for="techRecord_adrDetails_memosApply"> Yes </label>
            </div>
          </div>
        </fieldset>
      </div>

      <!-- M145 -->
      <div class="govuk-form-group">
        <fieldset class="govuk-fieldset" aria-describedby="techRecord_adrDetails_m145Statement-error">
          <legend class="govuk-fieldset__legend govuk-fieldset__legend--m">
            <h1 class="govuk-fieldset__heading">M145</h1>
          </legend>
          <app-control-errors for="techRecord_adrDetails_m145Statement" />
          <div class="govuk-checkboxes" data-module="govuk-checkboxes">
            <div class="govuk-checkboxes__item">
              <input
                class="govuk-checkboxes__input"
                id="techRecord_adrDetails_m145Statement"
                formControlName="techRecord_adrDetails_m145Statement"
                type="checkbox"
                [value]="true"
                [attr.aria-describedby]="isInvalid('techRecord_adrDetails_m145Statement') ? 'techRecord_adrDetails_m145Statement-error' : null"
              />
              <label class="govuk-label govuk-checkboxes__label" for="techRecord_adrDetails_m145Statement"> Yes </label>
            </div>
          </div>
        </fieldset>
      </div>
    </ng-container>

    <!-- When ADR body type contains 'battery' -->
    <ng-container *ngIf="adrService.canDisplayBatterySection($any(form.getRawValue()))">
      <!-- Battery list applicable -->
      <div class="govuk-form-group">
        <h1 class="govuk-label-wrapper">
          <label class="govuk-label govuk-label--m" for="techRecord_adrDetails_listStatementApplicable"> Battery List Applicable </label>
        </h1>
        <app-control-errors for="techRecord_adrDetails_listStatementApplicable" />
        <div class="govuk-radios" data-module="govuk-radios">
          <div class="govuk-radios__item" *ngFor="let option of batteryListApplicableOptions">
            <input
              type="radio"
              id="techRecord_adrDetails_listStatementApplicable-{{ option.value }}-radio"
              formControlName="techRecord_adrDetails_listStatementApplicable"
              class="govuk-radios__input"
              [value]="option.value"
            />
            <label class="govuk-label govuk-radios__label" for="techRecord_adrDetails_listStatementApplicable-{{ option.value }}-radio'">
              {{ option.label }}
            </label>
          </div>
        </div>
      </div>

      <!-- When Battery list applicable is true -->
      <ng-container *ngIf="adrService.canDisplayBatteryListNumberSection($any(form.getRawValue()))">
        <!-- Battery list reference number -->
        <div class="govuk-form-group">
          <h1 class="govuk-label-wrapper">
            <label class="govuk-label govuk-label--m" for="techRecord_adrDetails_batteryListNumber"> Reference number </label>
          </h1>
          <app-control-errors for="techRecord_adrDetails_batteryListNumber" />
          <input
            id="techRecord_adrDetails_batteryListNumber"
            type="text"
            name="techRecord_adrDetails_batteryListNumber"
            formControlName="techRecord_adrDetails_batteryListNumber"
            class="govuk-input govuk-!-width-one-third"
            [class.govuk-input--error]="isInvalid('techRecord_adrDetails_batteryListNumber')"
          />
        </div>
      </ng-container>
    </ng-container>

    <!-- Declarations seen section -->
    <span class="govuk-label govuk-label--m">Declarations seen</span>

    <!-- Manufacturer brake declaration -->
    <div class="govuk-form-group">
      <fieldset class="govuk-fieldset" aria-describedby="techRecord_adrDetails_brakeDeclarationsSeen-error">
        <app-control-errors for="techRecord_adrDetails_brakeDeclarationsSeen" />
        <div class="govuk-checkboxes" data-module="govuk-checkboxes">
          <div class="govuk-checkboxes__item">
            <input
              class="govuk-checkboxes__input"
              id="techRecord_adrDetails_brakeDeclarationsSeen"
              formControlName="techRecord_adrDetails_brakeDeclarationsSeen"
              type="checkbox"
              [value]="true"
              [attr.aria-describedby]="
                isInvalid('techRecord_adrDetails_brakeDeclarationsSeen') ? 'techRecord_adrDetails_brakeDeclarationsSeen-error' : null
              "
              checked
            />
            <label class="govuk-label govuk-checkboxes__label" for="techRecord_adrDetails_brakeDeclarationsSeen">
              Manufacturer brake declaration
            </label>
          </div>
        </div>
      </fieldset>
    </div>

    <!-- Issuer -->
    <div class="govuk-form-group govuk-character-count" *ngIf="adrService.canDisplayIssueSection($any(form.getRawValue()))">
      <h1 class="govuk-label-wrapper">
        <label class="govuk-label govuk-label--m" for="techRecord_adrDetails_brakeDeclarationIssuer"> Issuer </label>
      </h1>
      <app-control-errors for="techRecord_adrDetails_brakeDeclarationIssuer" />
      <textarea govukTextarea formControlName="techRecord_adrDetails_brakeDeclarationIssuer"></textarea>
      <app-character-count for="techRecord_adrDetails_brakeDeclarationIssuer" [limit]="500" />
    </div>

    <!-- Brake endurance -->
    <div class="govuk-form-group">
      <fieldset class="govuk-fieldset" aria-describedby="techRecord_adrDetails_brakeEndurance-error">
        <app-control-errors for="techRecord_adrDetails_brakeEndurance" />
        <div class="govuk-checkboxes" data-module="govuk-checkboxes">
          <div class="govuk-checkboxes__item">
            <input
              class="govuk-checkboxes__input"
              id="techRecord_adrDetails_brakeEndurance"
              formControlName="techRecord_adrDetails_brakeEndurance"
              type="checkbox"
              [value]="true"
              [attr.aria-describedby]="isInvalid('techRecord_adrDetails_brakeEndurance') ? 'techRecord_adrDetails_brakeEndurance-error' : null"
              checked
            />
            <label class="govuk-label govuk-checkboxes__label" for="techRecord_adrDetails_brakeEndurance"> Owner/operator declaration </label>
          </div>
        </div>
      </fieldset>
    </div>

    <!-- Weight (tonnes) -->
    <div class="govuk-form-group" *ngIf="adrService.canDisplayWeightSection($any(form.getRawValue()))">
      <h1 class="govuk-label-wrapper">
        <label class="govuk-label govuk-label--m" for="techRecord_adrDetails_weight"> Weight (tonnes) </label>
      </h1>
      <app-control-errors for="techRecord_adrDetails_weight" />
      <div class="govuk-input__wrapper">
        <input govukInput class="govuk-input--width-5" spellcheck="false" formControlName="techRecord_adrDetails_weight" />
        <div class="govuk-input__suffix" aria-hidden="true">tonnes</div>
      </div>
    </div>

    <!-- Delcarations seen (Owner/operator declaration )-->
    <div class="govuk-form-group">
      <fieldset class="govuk-fieldset" aria-describedby="techRecord_adrDetails_declarationsSeen-error">
        <legend class="govuk-fieldset__legend govuk-fieldset__legend--m">
          <h1 class="govuk-fieldset__heading">Owner/operator declaration</h1>
        </legend>
        <app-control-errors for="techRecord_adrDetails_declarationsSeen" />
        <div class="govuk-checkboxes" data-module="govuk-checkboxes">
          <div class="govuk-checkboxes__item">
            <input
              class="govuk-checkboxes__input"
              id="techRecord_adrDetails_declarationsSeen"
              formControlName="techRecord_adrDetails_declarationsSeen"
              type="checkbox"
              [value]="true"
              [attr.aria-describedby]="isInvalid('techRecord_adrDetails_declarationsSeen') ? 'techRecord_adrDetails_declarationsSeen-error' : null"
            />
            <label class="govuk-label govuk-checkboxes__label" for="techRecord_adrDetails_declarationsSeen"> Yes </label>
          </div>
        </div>
      </fieldset>
    </div>

    <!-- New certificate required -->
    <div class="govuk-form-group">
      <fieldset class="govuk-fieldset" aria-describedby="techRecord_adrDetails_newCertificateRequested-error">
        <legend class="govuk-fieldset__legend govuk-fieldset__legend--m">
          <h1 class="govuk-fieldset__heading">New certificate required</h1>
        </legend>
        <app-control-errors for="techRecord_adrDetails_newCertificateRequested" />
        <div class="govuk-checkboxes" data-module="govuk-checkboxes">
          <div class="govuk-checkboxes__item">
            <input
              class="govuk-checkboxes__input"
              id="techRecord_adrDetails_newCertificateRequested"
              formControlName="techRecord_adrDetails_newCertificateRequested"
              type="checkbox"
              [value]="true"
              [attr.aria-describedby]="
                isInvalid('techRecord_adrDetails_newCertificateRequested') ? 'techRecord_adrDetails_newCertificateRequested-error' : null
              "
            />
            <label class="govuk-label govuk-checkboxes__label" for="techRecord_adrDetails_newCertificateRequested"> Yes </label>
          </div>
        </div>
      </fieldset>
    </div>

    <!-- ADR Additional Examiner Note -->
    <div class="govuk-form-group govuk-character-count">
      <h1 class="govuk-label-wrapper">
        <label class="govuk-label govuk-label--m" for="techRecord_adrDetails_additionalExaminerNotes_note"> ADR Certificate Notes </label>
      </h1>
      <div id="techRecord_adrDetails_additionalExaminerNotes_note-hint" class="govuk-hint">Will not be present on the ADR certificate</div>
      <app-control-errors for="techRecord_adrDetails_additionalExaminerNotes_note" />
      <textarea govukTextarea formControlName="techRecord_adrDetails_additionalExaminerNotes_note"></textarea>
      <app-character-count for="techRecord_adrDetails_additionalExaminerNotes_note" [limit]="1024" />
    </div>

    <!-- ADR Additional Examiner Note History -->
    <h2 class="govuk-heading-m">Additional Examiner Notes History</h2>
    <ng-container *ngIf="form.controls.techRecord_adrDetails_additionalExaminerNotes?.value as notes; else noExaminerNotes">
      <ng-container *ngIf="notes?.length as notesCount; else noExaminerNotes">
        <table class="govuk-table">
          <tbody class="govuk-table__body">
            <tr class="govuk-table__row">
              <th scope="col" class="govuk-table__header">Notes</th>
              <th scope="col" class="govuk-table__header">Created By</th>
              <th scope="col" class="govuk-table__header">Date</th>
              <th scope="col" class="govuk-table__header"></th>
            </tr>
            <ng-container *ngIf="pagination.paginationOptions | async as page">
              <tr class="govuk-table__row" *ngFor="let note of notes.slice(page.start, page.end)">
                <td class="govuk-table__cell">{{ note.note | defaultNullOrEmpty }}</td>
                <td class="govuk-table__cell">{{ note.lastUpdatedBy | defaultNullOrEmpty }}</td>
                <td class="govuk-table__cell">{{ note.createdAtDate | date : 'dd/MM/yyyy HH:mm' | defaultNullOrEmpty }}</td>
                <td class="govuk-table__cell">
                  <a class="govuk-link" href="javascript:void(0)"> Edit </a>
                </td>
              </tr>
            </ng-container>
          </tbody>
        </table>
        <app-pagination #pagination tableName="adr-notes-history" [numberOfItems]="notesCount" [itemsPerPage]="3" />
      </ng-container>
    </ng-container>
    <ng-template #noExaminerNotes>
      <dl class="govuk-summary-list">
        <div class="govuk-summary-list__row border-b-0">
          <dt class="govuk-summary-list__key">No additional examiner notes history available</dt>
        </div>
      </dl>
    </ng-template>

    <!-- ADR Certificate Notes -->
    <div class="govuk-form-group govuk-character-count">
      <h1 class="govuk-label-wrapper">
        <label class="govuk-label govuk-label--m" for="techRecord_adrDetails_adrCertificateNotes"> ADR Certificate Notes </label>
      </h1>
      <app-control-errors for="techRecord_adrDetails_adrCertificateNotes" />
      <textarea govukTextarea formControlName="techRecord_adrDetails_adrCertificateNotes"></textarea>
      <app-character-count for="techRecord_adrDetails_adrCertificateNotes" [limit]="1500" />
    </div>
  </ng-container>
</div>
