<form [formGroup]="form">
  <ng-container *ngIf="isPsv">
    <app-switchable-input
      [form]="form"
      [type]="types.NUMBER"
      name="speedRestriction"
      label="Speed Restriction"
      [isEditing]="isEditing"
      [width]="widths.XS"
      suffix="mph"
    ></app-switchable-input>

    <br />
  </ng-container>

  <table class="govuk-table">
    <caption class="govuk-table__caption govuk-table__caption--m">
      Tyre details
    </caption>

    <thead class="govuk-table__head">
      <tr class="govuk-table__row">
        <th scope="col" class="govuk-table__header"></th>
        <th scope="col" class="govuk-table__header">Code</th>
        <th scope="col" class="govuk-table__header">Size</th>
        <th scope="col" class="govuk-table__header">Ply</th>
        <th scope="col" class="govuk-table__header">Load Index</th>
        <th *ngIf="isPsv" scope="col" class="govuk-table__header">SR</th>
        <th scope="col" class="govuk-table__header">S/D</th>
        <th *ngIf="isEditing" scope="col" class="govuk-table__header"></th>
        <th *ngIf="isEditing" scope="col" class="govuk-table__header"></th>
      </tr>
    </thead>

    <tbody class="govuk-table__body">
      <tr *ngFor="let axle of axles.controls; let i = index" class="govuk-table__row" formArrayName="axles">
        <ng-container [formGroupName]="i">
          <th scope="row" class="govuk-table__header">T {{ axle.value.axleNumber }}</th>

          <ng-template
            [ngTemplateOutlet]="axleTdInput"
            [ngTemplateOutletContext]="{ name: 'tyreCode', type: types.NUMBER, width: widths.S }"
          ></ng-template>

          <ng-template
            [ngTemplateOutlet]="axleTdInput"
            [ngTemplateOutletContext]="{ name: 'tyreSize', type: types.TEXT, width: widths.XXL }"
          ></ng-template>

          <ng-template
            [ngTemplateOutlet]="axleTdInput"
            [ngTemplateOutletContext]="{ name: 'plyRating', type: types.TEXT, width: widths.XXS }"
          ></ng-template>

          <ng-template
            [ngTemplateOutlet]="axleTdInput"
            [ngTemplateOutletContext]="{ name: 'dataTrAxles', type: types.NUMBER, width: widths.XS }"
          ></ng-template>

          <ng-template
            *ngIf="isPsv"
            [ngTemplateOutlet]="axleTdInput"
            [ngTemplateOutletContext]="{ name: 'speedCategorySymbol', type: types.DROPDOWN, width: widths.XS, options: speedCategorySymbol }"
          ></ng-template>

          <ng-template
            [ngTemplateOutlet]="axleTdInput"
            [ngTemplateOutletContext]="{ name: 'fitmentCode', type: types.DROPDOWN, width: widths.XXS, options: fitmentCode }"
          ></ng-template>

          <td *ngIf="isEditing" class="govuk-table__cell">
            <a class="axleButton" (click)="getTyreSearchPage(axle.value.axleNumber)">Search</a>
          </td>

          <td *ngIf="isEditing" class="govuk-table__cell">
            <a class="axleButton" (click)="removeAxle(i)">Remove</a>
          </td>

          <ng-template #axleTdInput let-name="name" let-type="type" let-width="width" let-options="options">
            <td class="govuk-table__cell">
              <app-switchable-input
                [form]="getAxleTyres(i)"
                [type]="type"
                [name]="name"
                [isEditing]="isEditing"
                [width]="width"
                [options]="options"
                (focusout)="searchTyres(name, i + 1)"
              ></app-switchable-input>
            </td>
          </ng-template>
        </ng-container>
      </tr>

      <tr *ngIf="isEditing">
        <a class="axleButton" role="button" (click)="addAxle()">Add Axle</a>

        <p *ngIf="isError" class="govuk-error-message">{{ errorMessage }}</p>
      </tr>

      <ng-container *ngIf="!isPsv">
        <br />

        <app-switchable-input
          [form]="form"
          [type]="types.TEXT"
          name="tyreUseCode"
          label="Tyre Use Code"
          [isEditing]="isEditing"
        ></app-switchable-input>
      </ng-container>

      <ng-template #tdNumberInput let-name="name">
        <td class="govuk-table__cell">
          <app-switchable-input [form]="form" [type]="types.NUMBER" [name]="name" [isEditing]="isEditing"></app-switchable-input>
        </td>
      </ng-template>
    </tbody>
  </table>
</form>
