<div class="govuk-grid-row" *ngIf="currentTechRecord$ | async as currentTechRecord">
  <div class="govuk-grid-column-one-third">
    <div class="govuk-grid-row">
      <div class="govuk-grid-column-full">
        <app-tech-record-title [vehicle]="vehicle" [actions]="getActions(currentTechRecord)"></app-tech-record-title>

        <app-edit-tech-record-button
          *appRoleRequired="roles.TechRecordAmend"
          [vehicle]="vehicle"
          [viewableTechRecord]="currentTechRecord"
          [(isEditing)]="isEditing"
          [isDirty]="isDirty"
          (submitChange)="handleSubmit()"
        ></app-edit-tech-record-button>

        <ng-container
          *ngIf="
            (currentTechRecord.vehicleType === 'hgv' || currentTechRecord.vehicleType === 'trl') &&
            currentTechRecord.statusCode === statusCodes.CURRENT
          "
        >
          <app-button style="margin-left: 10px" (clicked)="generatePlate()" *appRoleRequired="roles.TechRecordAmend">Generate Plate</app-button>
          <app-view-plate *appRoleRequired="roles.TechRecordView"></app-view-plate>
        </ng-container>

        <app-tech-record-history [vehicle]="vehicle" [currentTechRecord]="currentTechRecord"></app-tech-record-history>

        <app-test-record-summary *appRoleRequired="roles.TestResultView" [testResults]="(testResults$ | async) || []"></app-test-record-summary>

        <ng-container *ngIf="!isArchived && !isEditing">
          <div class="govuk-button-group" *appRoleRequired="[roles.TestResultCreateContingency, roles.TestResultCreateDeskAssesment]">
            <a id="create-test" class="govuk-button" (click)="createTest(currentTechRecord)">Create a test for this vehicle</a>
          </div>
        </ng-container>
      </div>
    </div>
  </div>
  <div class="govuk-grid-column-two-thirds">
    <app-tech-record-summary
      [techRecord]="currentTechRecord"
      [isEditing]="isEditing"
      (isFormDirty)="isDirty = $event"
      (isFormInvalid)="isInvalid = $event"
    ></app-tech-record-summary>
  </div>
</div>
